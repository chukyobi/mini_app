"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),n=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;exports.ScratchCard=function(e){var r=e.width,o=void 0===r?300:r,i=e.height,u=void 0===i?150:i,c=e.image,a=void 0===c?"":c,s=e.finishPercent,l=void 0===s?60:s,d=e.onComplete,v=void 0===d?function(){}:d,m=e.brushSize,f=void 0===m?30:m,h=e.children,g=t.useRef(null),E=t.useRef(!1),p=t.useRef({x:0,y:0}),L=t.useRef(!1),C=t.useState(!1),y=C[0],b=C[1],w=function(e,t){var n=e.getBoundingClientRect();return{x:(t.clientX||t.touches[0].clientX)-n.left,y:(t.clientY||t.touches[0].clientY)-n.top}},x=t.useCallback((function(e){E.current=!0,p.current=w(g.current,e)}),[]),R=t.useCallback((function(e){if(E.current&&!L.current&&g.current){var t=g.current.getContext("2d"),n=w(g.current,e);t&&(t.globalCompositeOperation="destination-out",t.lineWidth=f,t.lineCap="round",t.beginPath(),t.moveTo(p.current.x,p.current.y),t.lineTo(n.x,n.y),t.stroke(),p.current=n,k(t))}}),[f]),k=t.useCallback((function(e){for(var t=e.getImageData(0,0,o,u).data,n=0,r=0;r<t.length;r+=4)0===t[r+3]&&n++;n/(o*u)*100>=l&&!L.current&&(L.current=!0,e.clearRect(0,0,o,u),v())}),[l,o,u,v]),O=t.useCallback((function(){E.current=!1}),[]);return t.useEffect((function(){if(g.current){var e=g.current;e.width=o,e.height=u;var t=e.getContext("2d");if(t){if(a){var n=new Image;n.crossOrigin="anonymous",n.src=a,n.onload=function(){t.drawImage(n,0,0,o,u),t.globalCompositeOperation="source-over",b(!0)},n.onerror=function(){console.error("Failed to load the image with CORS policy")}}else t.fillStyle="#000",t.fillRect(0,0,o,u),b(!0);e.addEventListener("mousedown",x),e.addEventListener("mousemove",R),e.addEventListener("mouseup",O),e.addEventListener("mouseout",O),e.addEventListener("touchstart",x),e.addEventListener("touchmove",R),e.addEventListener("touchend",O)}return function(){e.removeEventListener("mousedown",x),e.removeEventListener("mousemove",R),e.removeEventListener("mouseup",O),e.removeEventListener("mouseout",O),e.removeEventListener("touchstart",x),e.removeEventListener("touchmove",R),e.removeEventListener("touchend",O)}}return function(){}}),[x,R,O,a,o,u]),n.createElement("div",{style:{position:"relative",width:o,height:u}},n.createElement("div",{style:{position:"absolute",zIndex:999,width:o,height:u}},n.createElement("canvas",{ref:g})),y&&n.createElement("div",{style:{position:"relative",width:o,height:u}},h))};
//# sourceMappingURL=next-scratchcard.cjs.production.min.js.map
